(function(){angular.module("loc8rApp",["ngRoute","ngSanitize","ui.bootstrap"]);function e(e,o){e.when("/",{templateUrl:"/home/home.view.html",controller:"homeCtrl",controllerAs:"vm"}).when("/about",{templateUrl:"/common/views/genericText.view.html",controller:"aboutCtrl",controllerAs:"vm"}).when("/location/:locationid",{templateUrl:"/locationDetail/locationDetail.view.html",controller:"locationDetailCtrl",controllerAs:"vm"}).when("/register",{templateUrl:"/auth/register/register.view.html",controller:"registerCtrl",controllerAs:"vm"}).when("/login",{templateUrl:"/auth/login/login.view.html",controller:"loginCtrl",controllerAs:"vm"}).otherwise({redirectTo:"/"});o.html5Mode(true)}angular.module("loc8rApp").config(["$routeProvider","$locationProvider",e])})();(function(){angular.module("loc8rApp").controller("homeCtrl",e);e.$inject=["$scope","loc8rData","geolocation"];function e(e,o,t){if(window.location.pathname!=="/"){window.location.href="/#"+window.location.pathname}var n=this;console.log(window.location);n.pageHeader={title:"Ace",strapline:"Find places to work with wifi near you!"};n.sidebar={content:"Looking for wifi and a seat? Ace helps you find places to work when out and about. Perhaps with coffee, cake or a pint? Let Loc8r help you find the place you're looking for."};n.message="Checking your location";n.getData=function(e){var t=e.coords.latitude,r=e.coords.longitude;n.message="Searching for nearby places";o.locationByCoords(t,r).success(function(e){n.message=e.length>0?"":"No locations found nearby";n.data={locations:e};console.log(n.data)}).error(function(e){n.message="Sorry, something's gone wrong, please try again later"})};n.showError=function(o){e.$apply(function(){n.message=o.message})};n.noGeo=function(){e.$apply(function(){n.message="Geolocation is not supported by this browser."})};t.getPosition(n.getData,n.showError,n.noGeo)}})();(function(){angular.module("loc8rApp").controller("aboutCtrl",e);function e(){var e=this;e.pageHeader={title:"About Ace"};e.main={content:"Ace was created to help people find places to sit down and get a bit of work done. With Ace you are sure to find wifi for as far as 200km. \nYou can know how good wifi is by just viewing the rating as well as the reviews left by other users. You can also contribute by leaving a review for others who would be looking for wifi like you. Dont forget to share and let others know the power of ACE."+"\n\nAce, let your phone do the walking."}}})();(function(){angular.module("loc8rApp").controller("loginCtrl",e);e.$inject=["$location","authentication"];function e(e,o){var t=this;t.pageHeader={title:"Sign in to Loc8r"};t.credentials={email:"",password:""};t.returnPage=e.search().page||"/";t.onSubmit=function(){t.formError="";if(!t.credentials.email||!t.credentials.password){t.formError="All fields required, please try again";return false}else{t.doLogin()}};t.doLogin=function(){t.formError="";o.login(t.credentials).error(function(e){t.formError=e}).then(function(){e.search("page",null);e.path(t.returnPage)})}}})();(function(){angular.module("loc8rApp").controller("registerCtrl",e);e.$inject=["$location","authentication"];function e(e,o){var t=this;t.pageHeader={title:"Create a new Loc8r account"};t.credentials={name:"",email:"",password:""};t.returnPage=e.search().page||"/";t.onSubmit=function(){t.formError="";if(!t.credentials.name||!t.credentials.email||!t.credentials.password){t.formError="All fields required, please try again";return false}else{t.doRegister()}};t.doRegister=function(){t.formError="";o.register(t.credentials).error(function(e){t.formError=e}).then(function(){e.search("page",null);e.path(t.returnPage)})}}})();(function(){angular.module("loc8rApp").controller("locationDetailCtrl",e);e.$inject=["$routeParams","$location","$modal","loc8rData","authentication"];function e(e,o,t,n,r){var a=this;a.locationid=e.locationid;a.isLoggedIn=r.isLoggedIn();a.currentPath=o.path();n.locationById(a.locationid).success(function(e){a.data={location:e};a.pageHeader={title:a.data.location.name}}).error(function(e){console.log(e)});a.popupReviewForm=function(){var e=t.open({templateUrl:"/reviewModal/reviewModal.view.html",controller:"reviewModalCtrl as vm",resolve:{locationData:function(){return{locationid:a.locationid,locationName:a.data.location.name}}}});e.result.then(function(e){a.data.location.reviews.push(e)})}}})();(function(){angular.module("loc8rApp").controller("reviewModalCtrl",e);e.$inject=["$modalInstance","loc8rData","locationData"];function e(e,o,t){var n=this;n.locationData=t;n.onSubmit=function(){n.formError="";if(!n.formData.rating||!n.formData.reviewText){n.formError="All fields required, please try again";return false}else{n.doAddReview(n.locationData.locationid,n.formData)}};n.doAddReview=function(e,t){o.addReviewById(e,{rating:t.rating,reviewText:t.reviewText}).success(function(e){n.modal.close(e)}).error(function(e){n.formError="Your review has not been saved, please try again"});return false};n.modal={close:function(o){e.close(o)},cancel:function(){e.dismiss("cancel")}}}})();(function(){angular.module("loc8rApp").service("authentication",e);e.$inject=["$http","$window"];function e(e,o){var t=function(e){o.localStorage["loc8r-token"]=e};var n=function(){return o.localStorage["loc8r-token"]};var r=function(){var e=n();if(e){var t=JSON.parse(o.atob(e.split(".")[1]));return t.exp>Date.now()/1e3}else{return false}};var a=function(){if(r()){var e=n();var t=JSON.parse(o.atob(e.split(".")[1]));return{email:t.email,name:t.name}}};register=function(o){return e.post("/api/register",o).success(function(e){t(e.token)})};login=function(o){return e.post("/api/login",o).success(function(e){t(e.token)})};logout=function(){o.localStorage.removeItem("loc8r-token")};return{currentUser:a,saveToken:t,getToken:n,isLoggedIn:r,register:register,login:login,logout:logout}}})();(function(){angular.module("loc8rApp").service("geolocation",e);function e(){var e=function(e,o,t){if(navigator.geolocation){navigator.geolocation.getCurrentPosition(e,o)}else{t()}};return{getPosition:e}}})();(function(){angular.module("loc8rApp").service("loc8rData",e);e.$inject=["$http","authentication"];function e(e,o){var t=function(o,t){return e.get("/api/locations?lng="+t+"&lat="+o+"&maxDistance=200")};var n=function(o){return e.get("/api/locations/"+o)};var r=function(t,n){return e.post("/api/locations/"+t+"/reviews",n,{headers:{Authorization:"Bearer "+o.getToken()}})};return{locationByCoords:t,locationById:n,addReviewById:r}}})();(function(){angular.module("loc8rApp").filter("formatDistance",o);var e=function(e){return!isNaN(parseFloat(e))&&isFinite(e)};function o(){return function(o){var t,n;if(o&&e(o)){if(o>1){t=parseFloat(o).toFixed(1);n="km"}else{t=parseInt(o*1e3,10);n="m"}return t+n}else{return"?"}}}})();(function(){angular.module("loc8rApp").filter("addHtmlLineBreaks",e);function e(){return function(e){var o=e.replace(/\n/g,"<br/>");return o}}})();(function(){angular.module("loc8rApp").controller("navigationCtrl",e);e.$inject=["$location","authentication"];function e(e,o){var t=this;t.currentPath=e.path();t.isLoggedIn=o.isLoggedIn();t.currentUser=o.currentUser();t.logout=function(){o.logout();e.path("/")}}})();(function(){angular.module("loc8rApp").directive("navigation",e);function e(){return{restrict:"EA",templateUrl:"/common/directives/navigation/navigation.template.html",controller:"navigationCtrl as navvm"}}})();(function(){angular.module("loc8rApp").directive("footerGeneric",e);function e(){return{restrict:"EA",templateUrl:"/common/directives/footerGeneric/footerGeneric.template.html"}}})();(function(){angular.module("loc8rApp").directive("pageHeader",e);function e(){return{restrict:"EA",scope:{content:"=content"},templateUrl:"/common/directives/pageHeader/pageHeader.template.html"}}})();(function(){angular.module("loc8rApp").directive("ratingStars",e);function e(){return{restrict:"EA",scope:{thisRating:"=rating"},templateUrl:"/common/directives/ratingStars/ratingStars.template.html"}}})();