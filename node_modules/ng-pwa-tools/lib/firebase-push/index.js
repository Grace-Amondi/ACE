"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
require("reflect-metadata");
require("zone.js/dist/zone-node.js");
var fs = require("fs");
var lib_1 = require("./lib");
function generateFbPushConfig(args) {
    return Promise
        .all([
        lib_1.getDynamicLinksFromApp(args.dist, args.appModule, args.loadChildrenRoot, args.baseHref),
        lib_1.getStaticLinksFromIndex(args.index, args.baseHref),
    ])
        .then(function (_a) {
        var dynamicLinks = _a[0], staticLinks = _a[1];
        return lib_1.getFbHostingConfig(dynamicLinks, staticLinks);
    })
        .then(function (hosting) {
        var result = hosting;
        if (args.config) {
            result = JSON.parse(fs.readFileSync(args.config).toString());
            if (!result['hosting']) {
                result['hosting'] = hosting;
            }
            else {
                result['hosting']['headers'] = hosting.headers;
            }
        }
        return result;
    });
}
exports.generateFbPushConfig = generateFbPushConfig;
