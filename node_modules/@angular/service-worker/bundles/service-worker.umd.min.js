!function(r,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("rxjs/BehaviorSubject"),require("rxjs/Observable"),require("base64-js"),require("rxjs/add/observable/concat"),require("rxjs/add/observable/defer"),require("rxjs/add/observable/empty"),require("rxjs/add/observable/from"),require("rxjs/add/observable/fromEvent"),require("rxjs/add/observable/merge"),require("rxjs/add/observable/of"),require("rxjs/add/observable/timer"),require("rxjs/add/operator/concatMap"),require("rxjs/add/operator/do"),require("rxjs/add/operator/expand"),require("rxjs/add/operator/filter"),require("rxjs/add/operator/first"),require("rxjs/add/operator/let"),require("rxjs/add/operator/map"),require("rxjs/add/operator/mergeMap"),require("rxjs/add/operator/publishReplay"),require("rxjs/add/operator/reduce"),require("rxjs/add/operator/share"),require("rxjs/add/operator/switchMap"),require("rxjs/add/operator/take"),require("rxjs/add/operator/takeWhile")):"function"==typeof define&&define.amd?define(["exports","@angular/core","rxjs/BehaviorSubject","rxjs/Observable","base64-js","rxjs/add/observable/concat","rxjs/add/observable/defer","rxjs/add/observable/empty","rxjs/add/observable/from","rxjs/add/observable/fromEvent","rxjs/add/observable/merge","rxjs/add/observable/of","rxjs/add/observable/timer","rxjs/add/operator/concatMap","rxjs/add/operator/do","rxjs/add/operator/expand","rxjs/add/operator/filter","rxjs/add/operator/first","rxjs/add/operator/let","rxjs/add/operator/map","rxjs/add/operator/mergeMap","rxjs/add/operator/publishReplay","rxjs/add/operator/reduce","rxjs/add/operator/share","rxjs/add/operator/switchMap","rxjs/add/operator/take","rxjs/add/operator/takeWhile"],e):e((r.ng=r.ng||{},r.ng.serviceWorker=r.ng.serviceWorker||{}),r.ng.core,r.Rx,r.Rx,r.Base64Js,r.Rx,r.Rx,r.Rx,r.Rx,r.Rx,r.Rx,r.Rx,r.Rx,r.Rx,r.Rx,r.Rx,r.Rx,r.Rx,r.Rx,r.Rx,r.Rx,r.Rx,r.Rx,r.Rx,r.Rx,r.Rx,r.Rx)}(this,function(r,e,t,n,o,a,i,s,u,c,d,p,l,f,x,b,h,v,j,g,y,m,k,R,q,W,w){"use strict";function O(r){return n.Observable.create(function(e){r().then(function(r){return e.next(r)}).then(function(){return e.complete()}).catch(function(r){return e.error(r)})})}var M=function(){function r(r){this.ps=r}return r.prototype.auth=function(){return this.key("auth")},r.prototype.key=function(r){return void 0===r&&(r="p256dh"),o.fromByteArray(new Uint8Array(this.ps.getKey(r)))},Object.defineProperty(r.prototype,"url",{get:function(){return this.ps.endpoint},enumerable:!0,configurable:!0}),r.prototype.toJSON=function(){return this.ps.toJSON()},r.prototype.unsubscribe=function(){var r=this;return O(function(){return r.ps.unsubscribe()})},r}(),S=function(){function r(r){var e=this;this.zone=r,this.controllingWorker=new t.BehaviorSubject(void 0),this.container="object"==typeof navigator&&navigator.serviceWorker,this.container&&n.Observable.concat(n.Observable.of(this.container.controller),n.Observable.fromEvent(this.container,"controllerchange").map(function(r){return e.container.controller})).subscribe(function(r){return e.controllingWorker.next(r)},function(r){return e.controllingWorker.error(r)},function(){return e.controllingWorker.complete()}),this.awaitSingleControllingWorker=this.controllingWorker.filter(function(r){return!!r}).take(1),this.push=n.Observable.defer(function(){return e.send({cmd:"push"})}).share(),this.updates=n.Observable.defer(function(){return e.send({cmd:"update"})}).share()}return r.prototype.registrationForWorker=function(){var r=this;return function(e){return e.switchMap(function(e){return O(function(){return r.container.getRegistrations()}).expand(function(r){return n.Observable.from(r)}).filter(function(r){return r.active===e}).take(1)})}},r.prototype.sendToWorker=function(r,e){var t=this,o=new MessageChannel,a=new n.Observable(function(e){var n=null,a=function(r){var t=r.data;if(t&&"object"==typeof t&&t.hasOwnProperty("$ngsw")&&t.hasOwnProperty("id"))n=t.id;else{if(null===t)return e.complete(),void o.port1.removeEventListener("message",a);e.next(t)}};return o.port1.addEventListener("message",a),function(){o.port1.removeEventListener("message",a),t.sendToWorker(r,{cmd:"cancel",id:n})}}).takeWhile(function(r){return!!r}).publishReplay();return a.connect(),o.port1.start(),e.$ngsw=!0,r.postMessage(e,[o.port2]),a},r.prototype.send=function(r){var e=this;return this.awaitSingleControllingWorker.switchMap(function(t){return e.sendToWorker(t,r)})},r.prototype.ping=function(){return this.send({cmd:"ping"})},r.prototype.log=function(){return this.send({cmd:"log"})},r.prototype.activateUpdate=function(r){return this.send({cmd:"activateUpdate",version:r})},r.prototype.registerForPush=function(r){var e=this;return void 0===r&&(r={}),this.awaitSingleControllingWorker.let(this.registrationForWorker()).map(function(r){return r.pushManager}).switchMap(function(t){var o=n.Observable.create(function(n){var o=function(r){return new M(r)};t.getSubscription().then(function(e){if(e)return o(e);var n={userVisibleOnly:!0};if(r.applicationServerKey){for(var a=atob(r.applicationServerKey.replace(/_/g,"/").replace(/-/g,"+")),i=new Uint8Array(new ArrayBuffer(a.length)),s=0;s<a.length;s++)i[s]=a.charCodeAt(s);n.applicationServerKey=i}return t.subscribe(n).then(o)}).then(function(r){return e.zone.run(function(){return n.next(r)})}).then(function(){return e.zone.run(function(){return n.complete()})}).catch(function(r){return e.zone.run(function(){return n.error(r)})})});return o})},r.prototype.checkForUpdate=function(){return this.send({cmd:"checkUpdate"})},r}();S.decorators=[{type:e.Injectable}],S.ctorParameters=function(){return[{type:e.NgZone}]};var P=function(){function r(){}return r}();P.decorators=[{type:e.NgModule,args:[{providers:[S]}]}],P.ctorParameters=function(){return[]},r.NgServiceWorker=S,r.NgPushRegistration=M,r.ServiceWorkerModule=P,Object.defineProperty(r,"__esModule",{value:!0})});